# Komiko é¡¹ç›®å®Œæ•´æ¶æ„åˆ†ææ–‡æ¡£

> ç”Ÿæˆæ—¥æœŸï¼š2026-02-22
> é¡¹ç›®åç§°ï¼šadvanced-paint-app (Komiko)
> æŠ€æœ¯æ ˆï¼šNext.js 14 + React 18 + TypeScript + Supabase

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆæ€»è§ˆ](#æŠ€æœ¯æ ˆæ€»è§ˆ)
3. [é¡¹ç›®ç›®å½•ç»“æ„](#é¡¹ç›®ç›®å½•ç»“æ„)
4. [å‰ç«¯æ¶æ„](#å‰ç«¯æ¶æ„)
5. [åç«¯æ¶æ„](#åç«¯æ¶æ„)
6. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
7. [ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ](#ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ)
8. [éƒ¨ç½²é…ç½®](#éƒ¨ç½²é…ç½®)
9. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
10. [æ„å»ºä¸éƒ¨ç½²æµç¨‹](#æ„å»ºä¸éƒ¨ç½²æµç¨‹)

---

## é¡¹ç›®æ¦‚è¿°

**Komiko** æ˜¯ä¸€ä¸ªAIé©±åŠ¨çš„åŠ¨æ¼«åˆ›ä½œå’Œåª’ä½“å†…å®¹ç”Ÿæˆå¹³å°ï¼Œæ”¯æŒè§’è‰²åˆ›å»ºã€AIå›¾åƒ/è§†é¢‘ç”Ÿæˆã€ç¤¾äº¤åª’ä½“ã€å®æ—¶åä½œç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **AIå›¾åƒç”Ÿæˆ**ï¼šæ”¯æŒå¤šç§AIæ¨¡å‹ï¼ˆFluxã€SDXLã€Geminiç­‰ï¼‰
- **AIè§†é¢‘ç”Ÿæˆ**ï¼šå›¾åƒè½¬è§†é¢‘ã€æ–‡æœ¬è½¬è§†é¢‘ã€è§†é¢‘è½¬è§†é¢‘
- **æ¼«ç”»ç¼–è¾‘å™¨**ï¼šåŸºäºKonva.jsçš„ç”»å¸ƒç¼–è¾‘ç³»ç»Ÿ
- **è§’è‰²ç³»ç»Ÿ**ï¼šå®˜æ–¹è§’è‰²å’Œè‡ªå®šä¹‰è§’è‰²ï¼ˆOCï¼‰
- **ç¤¾äº¤åŠŸèƒ½**ï¼šå¸–å­ã€è¯„è®ºã€ç‚¹èµã€å…³æ³¨
- **æ”¯ä»˜ç³»ç»Ÿ**ï¼šè®¢é˜…åˆ¶å’Œä¿¡ç”¨åŒ…è´­ä¹°

---

## æŠ€æœ¯æ ˆæ€»è§ˆ

### å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Next.js | ^14 | å…¨æ ˆæ¡†æ¶ï¼ŒPages Router |
| React | ^18.2.0 | UIæ¡†æ¶ |
| TypeScript | ^5.6.2 | ç±»å‹ç³»ç»Ÿ |
| Tailwind CSS | ^3.4.4 | æ ·å¼æ¡†æ¶ |
| NextUI | ^2.4.2 | UIç»„ä»¶åº“ |
| Konva.js | ^9.3.3 | Canvasç¼–è¾‘ |
| react-konva | 18.2.10 | React Konvaç»‘å®š |
| Jotai | ^2.9.0 | çŠ¶æ€ç®¡ç† |
| i18next | ^24.2.3 | å›½é™…åŒ– |
| Framer Motion | ^11.3.28 | åŠ¨ç”»åº“ |
| html2canvas | ^1.4.1 | æˆªå›¾åŠŸèƒ½ |

### åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Vercel Functions | - | Serverlesså‡½æ•° |
| Supabase | ^2.45.0 | æ•°æ®åº“ã€å­˜å‚¨ã€è®¤è¯ |
| NextAuth | 4.24.7 | è®¤è¯ç³»ç»Ÿ |
| Stripe | ^17.5.0 | æ”¯ä»˜å¤„ç† |
| Node.js | v20.xx | è¿è¡Œæ—¶ç¯å¢ƒ |

### AI/ML æœåŠ¡

| æœåŠ¡ | SDK | ä¸»è¦åŠŸèƒ½ |
|------|-----|---------|
| FAL.ai | @fal-ai/client | å›¾åƒ/è§†é¢‘ç”Ÿæˆ |
| Replicate | replicate | å›¾åƒ/è§†é¢‘ç”Ÿæˆ |
| Google Gemini | @google/generative-ai | å›¾åƒ/æ–‡æœ¬ç”Ÿæˆ |
| Google GenAI | @google/genai | Vertex AIé›†æˆ |
| Anthropic Vertex | @anthropic-ai/vertex-sdk | Claudeé›†æˆ |
| Luma AI | @lumaai/sdk | è§†é¢‘ç”Ÿæˆ |
| RunwayML | @runwayml/sdk | è§†é¢‘ç”Ÿæˆ |
| OpenAI | openai | GPTé›†æˆ |
| Grok (X AI) | OpenRouter | æ–‡æœ¬/å›¾åƒç”Ÿæˆ |

### æ•°æ®å­˜å‚¨ä¸åˆ†æ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| PostgreSQL | - | ä¸»æ•°æ®åº“ |
| Supabase Storage | - | æ–‡ä»¶å­˜å‚¨ |
| PostHog | ^4.11.3 | äº‹ä»¶åˆ†æ |
| Mixpanel | mixpanel-browser | ç”¨æˆ·è¡Œä¸ºåˆ†æ |
| Vercel Analytics | ^1.3.1 | æ€§èƒ½åˆ†æ |

---

## é¡¹ç›®ç›®å½•ç»“æ„

```
KomikoCopy/
â”œâ”€â”€ api/                           # åç«¯APIè·¯ç”± (269ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ _models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ User.ts                # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ credit.ts              # ä¿¡ç”¨ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ roles.ts               # è§’è‰²æƒé™
â”‚   â”œâ”€â”€ _utils/                    # å·¥å…·å‡½æ•°å’Œä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ middlewares/           # APIä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts            # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ canConsume.ts      # ä¿¡ç”¨æ£€æŸ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ tryGenerate.ts     # è¯•ç”¨é™åˆ¶
â”‚   â”‚   â”‚   â”œâ”€â”€ translate.ts       # ç¿»è¯‘
â”‚   â”‚   â”‚   â”œâ”€â”€ improvePrompt.ts   # Promptå¢å¼º
â”‚   â”‚   â”‚   â”œâ”€â”€ replaceCharacterPrompts.ts
â”‚   â”‚   â”‚   â””â”€â”€ benefits.ts        # è®¢é˜…ç¦åˆ©
â”‚   â”‚   â”œâ”€â”€ email.ts               # é‚®ä»¶å‘é€
â”‚   â”‚   â”œâ”€â”€ gemini.ts              # Geminiå·¥å…·
â”‚   â”‚   â”œâ”€â”€ lark.ts                # é£ä¹¦é€šçŸ¥
â”‚   â”‚   â”œâ”€â”€ moderation.ts          # å†…å®¹å®¡æ ¸
â”‚   â”‚   â”œâ”€â”€ posthog.ts             # åˆ†æè·Ÿè¸ª
â”‚   â”‚   â””â”€â”€ index.ts               # æ ¸å¿ƒå·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ generation/                # AIç”ŸæˆAPI
â”‚   â”‚   â”œâ”€â”€ submit.ts              # æäº¤ç”Ÿæˆä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ query.ts               # æŸ¥è¯¢ç”ŸæˆçŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ webhook.ts             # Webhookå¤„ç†
â”‚   â”‚   â””â”€â”€ _common/
â”‚   â”‚       â””â”€â”€ models.ts          # 60+æ¨¡å‹é…ç½®
â”‚   â”œâ”€â”€ payment/                    # æ”¯ä»˜API
â”‚   â”‚   â”œâ”€â”€ create.ts              # åˆ›å»ºæ”¯ä»˜
â”‚   â”‚   â”œâ”€â”€ createOneTime.ts       # ä¸€æ¬¡æ€§æ”¯ä»˜
â”‚   â”‚   â”œâ”€â”€ webhook.ts             # Stripe Webhook
â”‚   â”‚   â””â”€â”€ subscription/          # è®¢é˜…ç®¡ç†
â”‚   â”œâ”€â”€ tools/                      # å·¥å…·API (33ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ image-generation.ts
â”‚   â”‚   â”œâ”€â”€ image-to-video.ts
â”‚   â”‚   â”œâ”€â”€ video-to-video.ts
â”‚   â”‚   â”œâ”€â”€ style-transfer.ts
â”‚   â”‚   â”œâ”€â”€ image-upscale.ts
â”‚   â”‚   â”œâ”€â”€ background-removal.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ v2/                         # V2 API (19ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ generateImage*.ts     # 21+å›¾åƒç”Ÿæˆç«¯ç‚¹
â”‚   â”‚   â””â”€â”€ generateComics*.ts     # æ¼«ç”»ç”Ÿæˆ
â”‚   â”œâ”€â”€ user/                       # ç”¨æˆ·ç›¸å…³API
â”‚   â”œâ”€â”€ character/                  # è§’è‰²ç›¸å…³API
â”‚   â”œâ”€â”€ post/                       # å¸–å­ç›¸å…³API
â”‚   â”œâ”€â”€ tag/                        # æ ‡ç­¾ç›¸å…³API
â”‚   â”œâ”€â”€ search/                     # æœç´¢API
â”‚   â”œâ”€â”€ explore/                    # æ¢ç´¢API
â”‚   â”œâ”€â”€ fal/                        # FAL.aié›†æˆ
â”‚   â”œâ”€â”€ animateanyone/             # åŠ¨ç”»ç”Ÿæˆ
â”‚   â”œâ”€â”€ badges/                     # å¾½ç« ç³»ç»Ÿ
â”‚   â”œâ”€â”€ lark/                       # é£ä¹¦é›†æˆ
â”‚   â””â”€â”€ ghost/                      # Ghost CMSé›†æˆ
â”‚
â”œâ”€â”€ src/                           # å‰ç«¯æºä»£ç  (çº¦2000ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ Components/                 # Reactç»„ä»¶ (292ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ Header/                # å¯¼èˆªå¤´éƒ¨
â”‚   â”‚   â”œâ”€â”€ Sidebar/               # ä¾§è¾¹æ 
â”‚   â”‚   â”œâ”€â”€ InfCanva/              # æ ¸å¿ƒç”»å¸ƒç¼–è¾‘å™¨ (86KB)
â”‚   â”‚   â”œâ”€â”€ character/             # è§’è‰²ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Comments/              # è¯„è®ºç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ Feed/                  # ç¤¾äº¤æµ
â”‚   â”‚   â”œâ”€â”€ Homepage/              # é¦–é¡µç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ VideoGeneration/       # è§†é¢‘ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ VideoToVideo/          # è§†é¢‘è½¬è§†é¢‘
â”‚   â”‚   â”œâ”€â”€ Modals/                # æ¨¡æ€æ¡†
â”‚   â”‚   â”œâ”€â”€ common/                # é€šç”¨UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ SEO/                   # SEOç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ PWA/                   # PWAåŠŸèƒ½
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                      # Next.jsé¡µé¢ (109ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ index.tsx              # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ _app.tsx               # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ _document.tsx          # HTMLæ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ ai-anime-generator.tsx # AIåŠ¨æ¼«ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ ai-comic-generator.tsx # æ¼«ç”»ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ video-to-video.tsx     # è§†é¢‘è½¬è§†é¢‘
â”‚   â”‚   â”œâ”€â”€ oc-maker.tsx           # OCåˆ›å»º
â”‚   â”‚   â”œâ”€â”€ playground.tsx         # é£æ ¼æ»¤é•œ
â”‚   â”‚   â”œâ”€â”€ image-animation-generator.tsx
â”‚   â”‚   â”œâ”€â”€ profile.tsx            # ç”¨æˆ·èµ„æ–™
â”‚   â”‚   â”œâ”€â”€ community.tsx          # ç¤¾åŒº
â”‚   â”‚   â”œâ”€â”€ search.tsx             # æœç´¢
â”‚   â”‚   â”œâ”€â”€ characters.tsx         # è§’è‰²åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ create/                # åˆ›ä½œå·¥ä½œåŒº
â”‚   â”‚   â”œâ”€â”€ publish.tsx            # å‘å¸ƒæµç¨‹
â”‚   â”‚   â”œâ”€â”€ post/[id].tsx          # å¸–å­è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ ai-anime-generator/[variant].tsx
â”‚   â”‚   â”œâ”€â”€ character/[character_id]/
â”‚   â”‚   â”œâ”€â”€ blog/[...slug]/        # åšå®¢æ–‡ç« 
â”‚   â”‚   â”œâ”€â”€ tags/[tag]/            # æ ‡ç­¾é¡µ
â”‚   â”‚   â”œâ”€â”€ api/                   # Next.js APIè·¯ç”±
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ state/                      # çŠ¶æ€ç®¡ç† (Jotai)
â”‚   â”‚   â”œâ”€â”€ index.ts               # ä¸»çŠ¶æ€å®šä¹‰ (751è¡Œ)
â”‚   â”‚   â”œâ”€â”€ block.ts               # ç”¨æˆ·å±è”½
â”‚   â”‚   â”œâ”€â”€ promotion.ts           # ä¿ƒé”€æ´»åŠ¨
â”‚   â”‚   â””â”€â”€ report.ts              # ä¸¾æŠ¥ç³»ç»Ÿ
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                      # è‡ªå®šä¹‰Hooks (63ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ useCharacters          # è§’è‰²æ•°æ®
â”‚   â”‚   â”œâ”€â”€ useCharacterCollections
â”‚   â”‚   â”œâ”€â”€ useOwnedCharacters
â”‚   â”‚   â”œâ”€â”€ useRecentCharacters
â”‚   â”‚   â”œâ”€â”€ useCreateBubble        # åˆ›å»ºæ°”æ³¡
â”‚   â”‚   â”œâ”€â”€ useCreateComicImage    # åˆ›å»ºæ¼«ç”»å›¾åƒ
â”‚   â”‚   â”œâ”€â”€ useCreateText         # åˆ›å»ºæ–‡æœ¬
â”‚   â”‚   â”œâ”€â”€ useCreateMarkArea      # åˆ›å»ºæ ‡è®°åŒºåŸŸ
â”‚   â”‚   â”œâ”€â”€ useCheckAuth           # è®¤è¯æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ useGoogleOneTap        # Googleä¸€é”®ç™»å½•
â”‚   â”‚   â”œâ”€â”€ useDailyCheckInTrigger # æ¯æ—¥ç­¾åˆ°
â”‚   â”‚   â”œâ”€â”€ useMediaFromNavigation
â”‚   â”‚   â”œâ”€â”€ useFrameExtraction     # å¸§æå–
â”‚   â”‚   â”œâ”€â”€ useVideoControl        # è§†é¢‘æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ useMediaQuery          # åª’ä½“æŸ¥è¯¢
â”‚   â”‚   â”œâ”€â”€ useOutsideClick        # ç‚¹å‡»å¤–éƒ¨æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ useScroll              # æ»šåŠ¨å¤„ç†
â”‚   â”‚   â”œâ”€â”€ useKeyboardShortcuts   # å¿«æ·é”®
â”‚   â”‚   â”œâ”€â”€ useLazyValidation      # å»¶è¿ŸéªŒè¯
â”‚   â”‚   â”œâ”€â”€ usePostSEO             # SEO
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ utilities/                 # å·¥å…·å‡½æ•° (39ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ analytics.ts           # åˆ†æè·Ÿè¸ª
â”‚   â”‚   â”œâ”€â”€ audio.ts               # éŸ³é¢‘å¤„ç†
â”‚   â”‚   â”œâ”€â”€ auth/                  # è®¤è¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ constants.ts           # å¸¸é‡
â”‚   â”‚   â”œâ”€â”€ draft.ts               # è‰ç¨¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ env.ts                 # ç¯å¢ƒå˜é‡
â”‚   â”‚   â”œâ”€â”€ fal.ts                 # FAL.aié›†æˆ
â”‚   â”‚   â”œâ”€â”€ imageOptimization.ts   # å›¾åƒä¼˜åŒ–
â”‚   â”‚   â”œâ”€â”€ imageTask.ts           # å›¾åƒä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ mediaCompression.ts    # åª’ä½“å‹ç¼©
â”‚   â”‚   â”œâ”€â”€ offline.ts             # ç¦»çº¿åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ polling.ts             # è½®è¯¢
â”‚   â”‚   â”œâ”€â”€ uploadUtils.ts         # ä¸Šä¼ å·¥å…·
â”‚   â”‚   â”œâ”€â”€ uppyUpload.ts          # Uppyä¸Šä¼ 
â”‚   â”‚   â”œâ”€â”€ watermark.ts           # æ°´å°
â”‚   â”‚   â”œâ”€â”€ video/                 # è§†é¢‘å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ firstFrameExtractor.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ videoTrimmer.ts
â”‚   â”‚   â”‚   â””â”€â”€ videoActions.ts
â”‚   â”‚   â””â”€â”€ adConsent.ts           # å¹¿å‘ŠåŒæ„
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                        # æœåŠ¡ç«¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ characterVariantSSR.ts # SSRè§’è‰²å˜ä½“
â”‚   â”‚   â”œâ”€â”€ ghost.ts               # Ghost CMSé›†æˆ
â”‚   â”‚   â”œâ”€â”€ server-translations.ts # æœåŠ¡ç«¯ç¿»è¯‘
â”‚   â”‚   â”œâ”€â”€ tagVariantSSR.ts       # SSRæ ‡ç­¾å˜ä½“
â”‚   â”‚   â”œâ”€â”€ utils.ts               # é€šç”¨å·¥å…·
â”‚   â”‚   â””â”€â”€ variant-loader.ts      # å˜ä½“åŠ è½½
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                        # APIå®¢æˆ·ç«¯ (9ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ comics.ts              # æ¼«ç”»API
â”‚   â”‚   â”œâ”€â”€ pricing.ts             # å®šä»·API
â”‚   â”‚   â”œâ”€â”€ profile.ts             # ç”¨æˆ·API
â”‚   â”‚   â”œâ”€â”€ request.ts             # è¯·æ±‚å·¥å…·
â”‚   â”‚   â”œâ”€â”€ story.ts               # æ•…äº‹API
â”‚   â”‚   â”œâ”€â”€ tools.ts               # å·¥å…·API
â”‚   â”‚   â”œâ”€â”€ type.ts                # APIç±»å‹
â”‚   â”‚   â”œâ”€â”€ upload.ts              # ä¸Šä¼ API
â”‚   â”‚   â””â”€â”€ world.ts               # ä¸–ç•ŒAPI
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ playgroundToEffectsMapping.mjs
â”‚   â”‚
â”‚   â”œâ”€â”€ constants/                  # å¸¸é‡å®šä¹‰ (çº¦90KB)
â”‚   â”‚   â””â”€â”€ index.tsx              # å·¥å…·ã€æšä¸¾ã€é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                       # æ•°æ®æ–‡ä»¶ (277ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ featuredTemplates.ts   # ç‰¹è‰²æ¨¡æ¿ (41KB)
â”‚   â”‚   â””â”€â”€ variants/              # å˜ä½“é…ç½®
â”‚   â”‚       â”œâ”€â”€ ai-anime-generator/ # 70+å˜ä½“
â”‚   â”‚       â”œâ”€â”€ ai-comic-generator/
â”‚   â”‚       â”œâ”€â”€ ai-video-effects/
â”‚   â”‚       â”œâ”€â”€ image-animation-generator/
â”‚   â”‚       â”œâ”€â”€ oc-maker/
â”‚   â”‚       â”œâ”€â”€ playground/
â”‚   â”‚       â””â”€â”€ video-to-video/
â”‚   â”‚
â”‚   â”œâ”€â”€ i18n/                       # å›½é™…åŒ– (4431ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ locales/
â”‚   â”‚       â”œâ”€â”€ en/                # è‹±æ–‡
â”‚   â”‚       â”œâ”€â”€ zh-CN/             # ç®€ä½“ä¸­æ–‡
â”‚   â”‚       â”œâ”€â”€ zh-TW/             # ç¹ä½“ä¸­æ–‡
â”‚   â”‚       â”œâ”€â”€ ja/                # æ—¥è¯­
â”‚   â”‚       â”œâ”€â”€ ko/                # éŸ©è¯­
â”‚   â”‚       â”œâ”€â”€ es/                # è¥¿ç­ç‰™è¯­
â”‚   â”‚       â”œâ”€â”€ fr/                # æ³•è¯­
â”‚   â”‚       â”œâ”€â”€ de/                # å¾·è¯­
â”‚   â”‚       â”œâ”€â”€ pt/                # è‘¡è„ç‰™è¯­
â”‚   â”‚       â”œâ”€â”€ ru/                # ä¿„è¯­
â”‚   â”‚       â”œâ”€â”€ hi/                # å°åœ°è¯­
â”‚   â”‚       â”œâ”€â”€ id/                # å°å°¼è¯­
â”‚   â”‚       â”œâ”€â”€ th/                # æ³°è¯­
â”‚   â”‚       â””â”€â”€ vi/                # è¶Šå—è¯­
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                      # TypeScriptç±»å‹
â”‚   â”‚   â”œâ”€â”€ index.ts               # ä¸»è¦ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ template.ts            # æ¨¡æ¿ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ content/                    # MDXå†…å®¹ (20ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ blog/
â”‚   â”‚   â”œâ”€â”€ guides/
â”‚   â”‚   â”œâ”€â”€ docs/
â”‚   â”‚   â””â”€â”€ pages/
â”‚   â”‚
â”‚   â”œâ”€â”€ Layout/                     # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ styles/                     # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ icons/                      # å›¾æ ‡ç»„ä»¶
â”‚   â”œâ”€â”€ helpers/                    # è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ assets/                     # é™æ€èµ„æº
â”‚   â””â”€â”€ middleware.ts               # Next.jsä¸­é—´ä»¶
â”‚
â”œâ”€â”€ scripts/                       # æ„å»ºè„šæœ¬ (77ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ build/                      # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ i18n/                       # å›½é™…åŒ–è„šæœ¬ (6ä¸ª)
â”‚   â”‚   â”œâ”€â”€ translateI18n.cjs     # åˆå§‹åŒ–ç¿»è¯‘
â”‚   â”‚   â”œâ”€â”€ updateI18n.cjs         # æ›´æ–°ç¿»è¯‘
â”‚   â”‚   â”œâ”€â”€ updateVariantI18n.cjs
â”‚   â”‚   â”œâ”€â”€ translateVariants.cjs
â”‚   â”‚   â””â”€â”€ syncI18n.cjs           # åŒæ­¥ç¿»è¯‘
â”‚   â”œâ”€â”€ variant-generation/        # SEOå˜ä½“ç”Ÿæˆ (50ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ generate-variant-page.mjs
â”‚   â”‚   â”œâ”€â”€ config.json
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ utils/                      # å·¥å…·è„šæœ¬
â”‚
â”œâ”€â”€ public/                        # é™æ€èµ„æº (1000ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ *.webp                     # 873ä¸ªWebPå›¾ç‰‡
â”‚   â”œâ”€â”€ *.png                      # 55ä¸ªPNG
â”‚   â”œâ”€â”€ *.jpg                      # 16ä¸ªJPG
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£ (13ä¸ªMarkdownæ–‡ä»¶)
â”œâ”€â”€ preparation/                   # å‡†å¤‡æ–‡ä»¶ (CSV, HTMLç­‰)
â”œâ”€â”€ types/                         # å…¨å±€ç±»å‹
â”œâ”€â”€ archive/                       # å½’æ¡£æ–‡ä»¶
â”‚
â”œâ”€â”€ next.config.mjs                # Next.jsé…ç½®
â”œâ”€â”€ tailwind.config.mjs             # Tailwindé…ç½®
â”œâ”€â”€ tsconfig.json                  # TypeScripté…ç½®
â”œâ”€â”€ contentlayer.config.ts         # å†…å®¹å±‚é…ç½®
â”œâ”€â”€ vercel.json                    # Vercelé…ç½®
â”œâ”€â”€ package.json                   # ä¾èµ–é…ç½®
â”œâ”€â”€ language.mjs                   # è¯­è¨€é…ç½®
â”œâ”€â”€ posthog.ts                     # PostHogé…ç½®
â”œâ”€â”€ global.css                     # å…¨å±€æ ·å¼
â”œâ”€â”€ global.d.ts                    # å…¨å±€ç±»å‹å£°æ˜
â”œâ”€â”€ env_list.json                  # ç¯å¢ƒå˜é‡åˆ—è¡¨
â”œâ”€â”€ å¼€å‘åŸåˆ™.md                    # å¼€å‘è§„èŒƒ
â”œâ”€â”€ CLAUDE.md                      # AIåŠ©æ‰‹æŒ‡å—
â””â”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
```

---

## å‰ç«¯æ¶æ„

### 1. é¡µé¢è·¯ç”± (Next.js Pages Router)

#### ä¸»è¦é¡µé¢

| è·¯å¾„ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| `/` | `index.tsx` | é¦–é¡µ - å·¥å…·å¡ç‰‡ã€åŠ¨æ€æµã€æ ‡ç­¾ç­›é€‰ |
| `/ai-anime-generator` | `ai-anime-generator.tsx` | AIåŠ¨æ¼«ç”Ÿæˆä¸»é¡µ |
| `/ai-comic-generator` | `ai-comic-generator.tsx` | æ¼«ç”»ç”Ÿæˆå·¥å…· |
| `/video-to-video` | `video-to-video.tsx` | è§†é¢‘é£æ ¼è½¬æ¢ |
| `/oc-maker` | `oc-maker.tsx` | åŸåˆ›è§’è‰²åˆ›å»ºå™¨ |
| `/playground` | `playground.tsx` | å›¾åƒé£æ ¼æ»¤é•œ |
| `/image-animation-generator` | `image-animation-generator.tsx` | å›¾åƒåŠ¨ç”»åŒ– |
| `/profile` | `profile.tsx` | ç”¨æˆ·èµ„æ–™é¡µ |
| `/community` | `community.tsx` | ç¤¾åŒºåŠ¨æ€æµ |
| `/search` | `search.tsx` | æœç´¢é¡µé¢ |
| `/characters` | `characters.tsx` | è§’è‰²åˆ—è¡¨ |
| `/publish` | `publish.tsx` | å†…å®¹å‘å¸ƒ |
| `/create/*` | `create/*` | åˆ›ä½œå·¥ä½œåŒº |
| `/post/[id]` | `post/[id].tsx` | å¸–å­è¯¦æƒ… |
| `/character/[character_id]/*` | `character/[character_id]/*` | è§’è‰²è¯¦æƒ… |
| `/blog/[...slug]` | `blog/[...slug]` | åšå®¢æ–‡ç«  |
| `/tags/[tag]` | `tags/[tag]` | æ ‡ç­¾é¡µé¢ |

#### åŠ¨æ€è·¯ç”±

- `/ai-anime-generator/[variant].tsx` - SEOå˜ä½“é¡µé¢
- `/image-animation-generator/*` - å›¾åƒåŠ¨ç”»å˜ä½“
- `/oc-maker/[variant].tsx` - OCå˜ä½“
- `/world/play` - ä¸–ç•Œç©æ³•

### 2. ç»„ä»¶æ¶æ„

#### æ ¸å¿ƒç»„ä»¶

**InfCanva (Canvasç¼–è¾‘å™¨)**
- ä½ç½®ï¼š`src/Components/InfCanva/InfCanva.tsx`
- å¤§å°ï¼šçº¦86KBæ ¸å¿ƒæ–‡ä»¶
- åŠŸèƒ½ï¼š
  - åŸºäºKonva.jsçš„ç”»å¸ƒç¼–è¾‘
  - æ”¯æŒå›¾å±‚ç®¡ç†ï¼ˆComicPageã€ComicImageã€ComicTextã€ComicBubbleï¼‰
  - å†å²è®°å½•ï¼ˆæ’¤é”€/é‡åšï¼‰
  - æ‹–æ‹½ã€ç¼©æ”¾ã€æ—‹è½¬
  - CNodeæŠ½è±¡å±‚ï¼ˆä¸KonvaèŠ‚ç‚¹è§£è€¦ï¼‰

**CNodeç±»å‹å®šä¹‰**
```typescript
- ComicPage: èƒŒæ™¯çŸ©å½¢ + å›¾åƒç»„
- ComicImage: å•ä¸ª/å¤šä¸ªKonva.Image
- ComicText: æ–‡æœ¬å…ƒç´ 
- ComicBubble: æ°”æ³¡ï¼ˆå¸¦Konva.GroupåŒ…è£…ï¼‰
- ComicMarkArea: é€‰æ‹©/æ ‡è®°åŒºåŸŸ
```

#### åŠŸèƒ½ç»„ä»¶

**è§’è‰²ç›¸å…³**
- `CharacterCard` - è§’è‰²å¡ç‰‡
- `CharacterFeed` - è§’è‰²åŠ¨æ€æµ
- `CharacterGrid` - è§’è‰²ç½‘æ ¼
- `CharacterList` - è§’è‰²åˆ—è¡¨

**ç¤¾äº¤ç»„ä»¶**
- `CommentItem` - å•æ¡è¯„è®º
- `CommentList` - è¯„è®ºåˆ—è¡¨
- `CommentSection` - è¯„è®ºåŒº
- `Feed` - ç¤¾äº¤æµç»„ä»¶

**ç¼–è¾‘ç»„ä»¶**
- `PoseEditor` - å§¿æ€ç¼–è¾‘å™¨
- `TemplatePicker` - æ¨¡æ¿é€‰æ‹©å™¨
- `TagSelector` - æ ‡ç­¾é€‰æ‹©å™¨
- `UploadFile` - æ–‡ä»¶ä¸Šä¼ 
- `ImageUploader` - å›¾ç‰‡ä¸Šä¼ 

**é€šç”¨UIç»„ä»¶** (`Components/common/`)
- Button, Input, Dialog, Dropdown
- Icons, Avatar, Badge
- Modal, Toast, Tooltip

#### SEOç»„ä»¶
- åŠ¨æ€å…ƒæ•°æ®ç”Ÿæˆ
- ç»“æ„åŒ–æ•°æ®
- Social Shareé¢„è§ˆ

#### PWAç»„ä»¶
- Service Workeræ³¨å†Œ
- ç¦»çº¿æç¤º
- åº”ç”¨å®‰è£…æç¤º

### 3. çŠ¶æ€ç®¡ç† (Jotai)

#### æ ¸å¿ƒAtom (`src/state/index.ts`)

**è®¤è¯ä¸ç”¨æˆ·**
```typescript
authAtom: boolean                          // è®¤è¯çŠ¶æ€
checkedAuthAtom: boolean                  // è®¤è¯æ£€æŸ¥çŠ¶æ€
profileAtom: Profile                      // ç”¨æˆ·èµ„æ–™
```

**å†…å®¹çŠ¶æ€**
```typescript
postListAtom: Post[]                      // å¸–å­åˆ—è¡¨
pageAtom: number                          // åˆ†é¡µ
feedTagAtom: string                       // åŠ¨æ€æµæ ‡ç­¾
```

**è§’è‰²çŠ¶æ€**
```typescript
characterListAtom: Character[]            // è§’è‰²åˆ—è¡¨
recentCharactersAtom: Character[]         // æœ€è¿‘ä½¿ç”¨çš„è§’è‰² (localStorage)
```

**ç”»å¸ƒçŠ¶æ€**
```typescript
appStateAtom: CNode[]                     // ç”»å¸ƒæ ‘ç»“æ„
historyAtom: HistoryItem[]                // å†å²è®°å½•
prevStepsAtom: CNode[]                    // æ’¤é”€æ ˆ
redoStepsAtom: CNode[]                    // é‡åšæ ˆ
comicPageSortingAtom: ComicPageSortInfo   // æ¼«ç”»é¡µæ’åº
```

**æ¨¡æ€æ¡†çŠ¶æ€**
```typescript
modalsAtom: ModalState                    // æ‰€æœ‰æ¨¡æ€æ¡†
loginModalAtom: boolean                   // ç™»å½•æ¨¡æ€æ¡†
```

**å…¶ä»–çŠ¶æ€**
```typescript
channelStateAtom: RealtimeChannel         // Supabaseå®æ—¶è¿æ¥
blockUserAtom: Set<string>                // å±è”½ç”¨æˆ·
promotionAtom: PromotionData              // ä¿ƒé”€æ´»åŠ¨
```

#### çŠ¶æ€æŒä¹…åŒ–
- ä½¿ç”¨`atomWithStorage`å®ç°localStorageæŒä¹…åŒ–
- è§’è‰²åˆ—è¡¨è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°

### 4. è‡ªå®šä¹‰Hooks

#### æ•°æ®è·å–Hook
```typescript
useCharacters()              // è·å–è§’è‰²åˆ—è¡¨
useCharacterCollections()    // è·å–è§’è‰²æ”¶è—
useOwnedCharacters()         // è·å–æ‹¥æœ‰çš„è§’è‰²
useRecentCharacters()        // æœ€è¿‘ä½¿ç”¨çš„è§’è‰²
```

#### åˆ›ä½œHook
```typescript
useCreateBubble()           // åˆ›å»ºå¯¹è¯æ°”æ³¡
useCreateComicImage()        // åˆ›å»ºæ¼«ç”»å›¾åƒ
useCreateText()              // åˆ›å»ºæ–‡æœ¬
useCreateMarkArea()          // åˆ›å»ºæ ‡è®°åŒºåŸŸ
```

#### è®¤è¯Hook
```typescript
useCheckAuth()               // æ£€æŸ¥è®¤è¯çŠ¶æ€
useGoogleOneTap()            // Googleä¸€é”®ç™»å½•
useDailyCheckInTrigger()     // æ¯æ—¥ç­¾åˆ°è§¦å‘
```

#### åª’ä½“Hook
```typescript
useMediaFromNavigation()     // ä»å¯¼èˆªè·å–åª’ä½“
useFrameExtraction()         // è§†é¢‘å¸§æå–
useVideoControl()            // è§†é¢‘æ§åˆ¶
useVideos()                  // è§†é¢‘åˆ—è¡¨
```

#### UIäº¤äº’Hook
```typescript
useMediaQuery()              // åª’ä½“æŸ¥è¯¢
useOutsideClick()            // ç‚¹å‡»å¤–éƒ¨æ£€æµ‹
useScroll()                  // æ»šåŠ¨å¤„ç†
useKeyboardShortcuts()       // å¿«æ·é”®
```

#### éªŒè¯Hook
```typescript
useLazyValidation()          // å»¶è¿ŸéªŒè¯
useCharacterAltPromptCheck()  // è§’è‰²æ›¿ä»£æç¤ºè¯æ£€æŸ¥
```

#### SEO Hook
```typescript
usePostSEO()                 // å¸–å­SEO
useCharacterSEO()            // è§’è‰²SEO
```

### 5. å·¥å…·å‡½æ•°

#### åˆ†æå·¥å…·
- `analytics.ts` - Mixpanelå’ŒPostHogè·Ÿè¸ª
- `posthog.ts` - PostHogå®¢æˆ·ç«¯é…ç½®

#### åª’ä½“å¤„ç†
- `audio.ts` - éŸ³é¢‘å¤„ç†
- `video/firstFrameExtractor.ts` - æå–è§†é¢‘é¦–å¸§
- `video/videoTrimmer.ts` - è§†é¢‘è£å‰ª
- `video/videoActions.ts` - è§†é¢‘æ“ä½œ
- `mediaCompression.ts` - åª’ä½“å‹ç¼©
- `imageOptimization.ts` - å›¾åƒä¼˜åŒ–

#### ä¸Šä¼ å·¥å…·
- `uploadUtils.ts` - ä¸Šä¼ å·¥å…·
- `uppyUpload.ts` - Uppyé›†æˆ
- `watermark.ts` - æ°´å°æ·»åŠ 

#### å…¶ä»–å·¥å…·
- `auth/` - è®¤è¯å·¥å…·
- `draft.ts` - è‰ç¨¿ç®¡ç†
- `offline.ts` - ç¦»çº¿åŠŸèƒ½
- `polling.ts` - è½®è¯¢
- `adConsent.ts` - å¹¿å‘ŠåŒæ„

### 6. å›½é™…åŒ– (i18n)

#### æ”¯æŒè¯­è¨€ (15ç§)
```typescript
en, ja, id, hi, zh-CN, zh-TW, ko,
es, fr, de, pt, ru, th, vi
```

#### ç¿»è¯‘æ–‡ä»¶ç»“æ„
```
src/i18n/locales/[lang]/
â”œâ”€â”€ common.json           (56KB - é€šç”¨UIæ–‡æœ¬)
â”œâ”€â”€ create.json           (38KB - åˆ›ä½œæµç¨‹)
â”œâ”€â”€ ai-anime-generator.json
â”œâ”€â”€ ai-comic-generator.json
â”œâ”€â”€ tools.json
â”œâ”€â”€ templates.json
â”œâ”€â”€ character.json
â”œâ”€â”€ post.json
â”œâ”€â”€ pricing.json
â”œâ”€â”€ profile.json
â”œâ”€â”€ blog.json
â”œâ”€â”€ feed.json
â””â”€â”€ ...
```

#### ç¿»è¯‘è„šæœ¬
```bash
npm run i18n:init          # åˆå§‹åŒ–ç¿»è¯‘
npm run i18n:update        # æ›´æ–°ç¿»è¯‘
npm run i18n:sync          # åŒæ­¥ç¿»è¯‘æ–‡ä»¶
npm run i18n:translate-variants  # ç¿»è¯‘å˜ä½“é¡µé¢
```

### 7. æ ·å¼ç³»ç»Ÿ

#### Tailwindé…ç½® (`tailwind.config.mjs`)

**ä¸»é¢˜**
- `caffelabs` - æµ…è‰²ä¸»é¢˜
- `caffelabs-dark` - æ·±è‰²ä¸»é¢˜
- æ”¯æŒæš—è‰²æ¨¡å¼åˆ‡æ¢ï¼ˆ`darkMode: 'class'`ï¼‰

**é¢œè‰²ç³»ç»Ÿ**
```css
--primary: #563AFA
--secondary: #1195f2
--background: #ffffff / #111827
--foreground: #0D001A / #ECEDEE
```

**è‡ªå®šä¹‰å­—ä½“**
```typescript
fontFamily: {
  custom: [
    'var(--font-nunito)',
    'Arial',
    'Anime Ace',
    'Wildwords',
    'CCMeanwhile',
    'Digital Strip',
    'Tight Spot',
  ],
}
```

**åŠ¨ç”»**
- Accordionå±•å¼€/æŠ˜å 
- Marqueeæ»šåŠ¨
- Meteoræµæ˜Ÿæ•ˆæœ
- Slideæ»‘åŠ¨
- Spinæ—‹è½¬

#### NextUIé›†æˆ
- å®Œæ•´çš„UIç»„ä»¶åº“
- è‡ªå®šä¹‰ä¸»é¢˜æ‰©å±•
- å“åº”å¼è®¾è®¡

---

## åç«¯æ¶æ„

### 1. APIè·¯ç”±ç»“æ„

#### è®¤è¯ä¸ç”¨æˆ·ç®¡ç†
```
/api/is_auth.ts              - èº«ä»½éªŒè¯æ£€æŸ¥
/api/getUserInfo.ts          - è·å–ç”¨æˆ·ä¿¡æ¯
/api/logout.ts               - ç™»å‡º
/api/deleteAccount.ts        - è´¦æˆ·åˆ é™¤
```

#### å†…å®¹ç”ŸæˆAPI
```
/api/generation/submit.ts    - æäº¤ç”Ÿæˆä»»åŠ¡
/api/generation/query.ts     - æŸ¥è¯¢ç”ŸæˆçŠ¶æ€
/api/generation/webhook.ts   - Webhookå¤„ç†
```

#### ç¤¾äº¤åª’ä½“åŠŸèƒ½
```
/api/fetchFeed.ts            - è·å–å†…å®¹æµ
/api/fetchProfile.ts         - è·å–ä¸ªäººèµ„æ–™
/api/post.ts, postStory.ts   - å‘å¸ƒå¸–å­/æ•…äº‹
/api/comment.ts              - è¯„è®ºç³»ç»Ÿ
/api/vote.ts                 - æŠ•ç¥¨/ç‚¹èµ
/api/follow.ts               - å…³æ³¨ç³»ç»Ÿ
/api/pinPost.ts              - å›ºå®šå¸–å­
/api/featurePost.ts          - ç²¾é€‰å¸–å­
/api/toggleNsfw.ts           - NSFWåˆ‡æ¢
/api/message.ts              - æ¶ˆæ¯ç³»ç»Ÿ
```

#### è§’è‰²ç³»ç»Ÿ
```
/api/createCharacter.ts      - åˆ›å»ºè§’è‰²
/api/updateCharacter.ts      - æ›´æ–°è§’è‰²
/api/deleteCharacter.ts      - åˆ é™¤è§’è‰²
/api/getOwnedCharacters.ts   - è·å–æ‹¥æœ‰çš„è§’è‰²
/api/getCollectedCharacters.ts - è·å–æ”¶è—çš„è§’è‰²
/api/characters.ts           - è§’è‰²ç›¸å…³æ“ä½œ
/api/getCharacterProfile.ts  - è·å–è§’è‰²èµ„æ–™
/api/getCharactersProfile.ts - æ‰¹é‡è·å–è§’è‰²èµ„æ–™
/api/checkCollectedCharacter.ts - æ£€æŸ¥æ”¶è—çŠ¶æ€
```

#### åª’ä½“å¤„ç†
```
/api/uploadImage.ts          - å›¾ç‰‡ä¸Šä¼ 
/api/uploadVideo.ts          - è§†é¢‘ä¸Šä¼ 
/api/upscale.ts              - å›¾ç‰‡æ”¾å¤§
/api/deleteVideo.ts          - åˆ é™¤è§†é¢‘
```

#### æ”¯ä»˜ç³»ç»Ÿ
```
/api/payment/create.ts              - åˆ›å»ºæ”¯ä»˜
/api/payment/createOneTime.ts       - ä¸€æ¬¡æ€§æ”¯ä»˜
/api/payment/webhook.ts             - Stripe Webhook
/api/payment/subscription/          - è®¢é˜…ç®¡ç†
/api/payment/subscription/cancel.ts
/api/payment/subscription/manage.ts
/api/payment/checkXSPackEligibility.ts
```

#### å…¶ä»–åŠŸèƒ½
```
/api/tags.ts                 - æ ‡ç­¾ç³»ç»Ÿ
/api/worlds.ts               - ä¸–ç•Œ/ä¸»é¢˜åˆ›å»º
/api/dailyCheckIn.ts         - æ¯æ—¥ç­¾åˆ°
/api/ranking.ts              - æ’è¡Œæ¦œ
/api/invitations.ts         - é‚€è¯·ç³»ç»Ÿ
/api/badges/                 - å¾½ç« ç³»ç»Ÿ
/api/favoriteStyles.ts       - æ”¶è—é£æ ¼
/api/redeemPromotionCode.ts  - å…‘æ¢ä¿ƒé”€ç 
/api/getActivePromotion.ts   - è·å–æ´»åŠ¨ä¿ƒé”€
/api/toggleNsfw.ts           - NSFWåˆ‡æ¢
/api/proxyProducthunt.ts     - ProductHuntä»£ç†
```

### 2. ä¸­é—´ä»¶ç³»ç»Ÿ (`api/_utils/middlewares/`)

#### ä¸­é—´ä»¶é“¾
```
Request
  â†’ [auth]                          # è®¤è¯éªŒè¯
  â†’ [benefits]                      # è®¢é˜…ç¦åˆ©åº”ç”¨
  â†’ [tryGenerate]                   # è¯•ç”¨é™åˆ¶
  â†’ [canConsume]                    # ä¿¡ç”¨æ£€æŸ¥
  â†’ [replaceCharacterPrompts]      # è§’è‰²æç¤ºè¯æ³¨å…¥
  â†’ [translate]                     # Promptç¿»è¯‘
  â†’ [improvePrompt]                 # Promptå¢å¼º
  â†’ Handler (4.5min timeout)
  â†’ Response
```

#### å„ä¸­é—´ä»¶åŠŸèƒ½

**auth.ts**
- éªŒè¯NextAuth session
- ä»Cookieè·å–ç”¨æˆ·ID
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨

**benefits.ts**
- åº”ç”¨è®¢é˜…ç­‰çº§ä¹˜æ•°
- æ£€æŸ¥ç”¨æˆ·ç¦åˆ©çŠ¶æ€

**tryGenerate.ts**
- å…è´¹ç”¨æˆ·é€Ÿç‡é™åˆ¶
- æ£€æŸ¥è¯•ç”¨æ¬¡æ•°

**canConsume.ts**
- éªŒè¯ä¿¡ç”¨ä½™é¢
- æ£€æŸ¥æ¶ˆè´¹èƒ½åŠ›

**replaceCharacterPrompts.ts**
- å°†è§’è‰²IDæ›¿æ¢ä¸ºè§’è‰²æè¿°
- æ”¯æŒ`@character_id`å’Œ`<character_id>`æ ¼å¼

**translate.ts**
- è‡ªåŠ¨ç¿»è¯‘éè‹±è¯­prompt
- æ”¯æŒ14ç§è¯­è¨€

**improvePrompt.ts**
- é€šè¿‡Geminiå¢å¼ºprompt
- æé«˜ç”Ÿæˆè´¨é‡

### 3. æ ¸å¿ƒå·¥å…·å‡½æ•° (`api/_utils/index.ts`)

#### è®¤è¯ä¸æ•°æ®åº“
```typescript
getAuthUserId()              // ä»Cookieè·å–ç”¨æˆ·ID
createSupabase()             // åˆ›å»ºSupabaseå®¢æˆ·ç«¯
```

#### åª’ä½“å¤„ç†
```typescript
uploadMedia()                // é€šç”¨åª’ä½“ä¸Šä¼ 
uploadMediaFromUrl()         // ä»URLä¸Šä¼ 
deleteMediaFromStorage()     // åˆ é™¤å­˜å‚¨æ–‡ä»¶
addWatermark()               // æ·»åŠ æ°´å° (Sharp)
getImageSize()               // è·å–å›¾ç‰‡å°ºå¯¸
```

#### AIé›†æˆ
```typescript
fetchGemini()                // Gemini APIè°ƒç”¨
fetchGeminiNano()            // Gemini Nanoè°ƒç”¨
fetchGeminiImageEdit()       // Geminiå›¾ç‰‡ç¼–è¾‘
grok()                       // Grok/X AIè°ƒç”¨
```

#### å…¶ä»–å·¥å…·
```typescript
sendEmail()                  // é‚®ä»¶å‘é€
sendLarkNotification()       // é£ä¹¦é€šçŸ¥
trackPostHogEvent()          // åˆ†æè·Ÿè¸ª
moderateContent()            // å†…å®¹å®¡æ ¸
stitchImages()               // å›¾ç‰‡æ‹¼æ¥
```

### 4. æ•°æ®æ¨¡å‹ (`api/_models/`)

#### User.ts
```typescript
isAdmin()                    // ç®¡ç†å‘˜éªŒè¯
isSubscribed()               // è®¢é˜…çŠ¶æ€æ£€æŸ¥
getUserById()                // è·å–ç”¨æˆ·
```

#### credit.ts (CreditModel)
```typescript
getFreeCredit()              // è·å–å…è´¹ç§¯åˆ†
getSubscriptionCredit()      // è·å–è®¢é˜…ç§¯åˆ†
deductCredit()               // æ‰£é™¤ç§¯åˆ†
canConsume()                 // æ¶ˆè´¹èƒ½åŠ›æ£€æŸ¥
renewSubscriptionCreditMonthly() // æœˆåˆè‡ªåŠ¨ç»­è´¹
```

#### roles.ts
```typescript
roles: {
  ADMIN: 1
}
```

### 5. AIç”ŸæˆAPI

#### æ”¯æŒçš„ç”Ÿæˆç±»å‹
```typescript
IMAGE = 1      // å›¾åƒç”Ÿæˆ
VIDEO = 2      // è§†é¢‘ç”Ÿæˆ
CHARACTER = 11 // è§’è‰²åˆ›å»º
```

#### è§†é¢‘æ¨¡å‹ (60+ä¸ªæ¨¡å‹)

**å›¾åƒè½¬è§†é¢‘ (I2V)**
- Luma Ray 2, Ray Flash 2
- Wan 2.6, Wan Pro, Wan 2.2 Turbo
- Kling v1.6, Kling 2.1
- Pixverse v3.5
- Vidu Q2 (Turbo, Pro, Reference)
- Sora 2 (Standard, Pro)
- Seedream 1.5 Pro
- Google Veo 3
- Minimax Hailuo 02
- Frame Pack
- Anisora, Magi-1, SE COG

**è§†é¢‘è½¬è§†é¢‘ (V2V)**
- Luma Ray 2 Flash Modify
- Runway Gen-4 Aleph
- Runway Act Two
- Wan Animate
- SE COG (ComfyUI)

**æ–‡æœ¬è½¬è§†é¢‘ (T2V)**
- æ‰€æœ‰I2Væ¨¡å‹çš„T2Vç‰ˆæœ¬
- Luma Ray 2, Wan 2.6, Kling 2.1, Vidu Q2
- Minimax, Google Veo 3, Sora 2

#### å›¾åƒç”Ÿæˆæ¨¡å‹
- Seedream v4.5 (æ–‡æœ¬/å›¾åƒè½¬å›¾åƒ)
- Seedream v4 (é—ç•™)
- Animagine XL 3.1
- Flux Kontext / Dev
- NoobaiXL
- Illustrious
- KUSA Art Pro / Art Unlimited / KusaXL
- Gemini Nano Banana / Pro

#### ä¿¡ç”¨æ¶ˆè€—è®¡ç®—

**å›¾åƒç”Ÿæˆ**
```typescript
IMAGE_ILLUSTRIOUS = 20 Zaps
IMAGE_FLUX_KONTEXT = 20 Zaps
IMAGE_NOOBAI_XL = 20 Zaps
IMAGE_SEEDREAM = 30 Zaps
IMAGE_GEMINI = 50 Zaps
IMAGE_ART_PRO = 30 Zaps
```

**è§†é¢‘ç”Ÿæˆ** (åŸºäºæ—¶é•¿å’Œåˆ†è¾¨ç‡)
```typescript
calculateImageToAnimationCost(model, duration, resolution)
calculateTextToVideoCost(model, duration, resolution, aspectRatio)
calculateVideoToVideoGenerationCost(model, duration)
```

**å…¶ä»–åŠŸèƒ½**
```typescript
VIDEO_UPSCALE = 480 Zaps
VIDEO_INTERPOLATION = 80 Zaps
FRAME_INTERPOLATION = 73 Zaps
LINE_ART_COLORIZE = 20 Zaps
```

#### Promptå¤„ç†æµç¨‹
1. è‡ªåŠ¨ç¿»è¯‘ï¼ˆéè‹±è¯­è¯·æ±‚ï¼‰
2. Promptå¢å¼ºï¼ˆé€šè¿‡Geminiï¼‰
3. è§’è‰²æåŠå¤„ç† (`@character_id` æˆ– `<character_id>`)
4. é£æ ¼æ ‡ç­¾æ”¯æŒ (`[style_name]`)
5. æ¨¡æ¿è¾“å…¥å˜é‡æ›¿æ¢

### 6. V2 API (`api/v2/`)

#### å›¾åƒç”Ÿæˆç«¯ç‚¹ (21+ä¸ª)
```
generateImageSeedream.ts
generateImageSDXL.ts
generateImageNoobaiXL.ts
generateImageNeta.ts
generateImageIllustrious.ts
generateImageGeminiNano.ts
generateImageGemini.ts
generateImageFluxKontextPro.ts
generateImageFluxKontext.ts
generateImageArtPro.ts
generateImageAnimagineXL4.ts
generateImageAnimagineXL3_1.ts
```

#### æ¼«ç”»ç”Ÿæˆ
```
generateComicsGemini.ts
generateCanvasImageGemini.ts
```

### 7. å·¥å…·API (`api/tools/`)

#### å›¾åƒå¤„ç†
```
image-generation.ts           # å›¾åƒç”Ÿæˆ
image-to-video.ts            # å›¾åƒè½¬è§†é¢‘
image-upscale.ts             # å›¾åƒæ”¾å¤§
style-transfer.ts            # é£æ ¼è¿ç§»
sketch-simplifier.ts         # è‰å›¾ç®€åŒ–
relighting.ts               # å…‰ç…§é‡è°ƒ
background-removal.ts       # èƒŒæ™¯ç§»é™¤
layer-splitter.ts           # å›¾å±‚åˆ†ç¦»
line-art-colorize.ts        # çº¿ç¨¿ä¸Šè‰²
line-art-colorize-new.ts
```

#### è§†é¢‘å¤„ç†
```
video-generation.ts         # è§†é¢‘ç”Ÿæˆ
video-to-video.ts           # è§†é¢‘è½¬è§†é¢‘
video-to-video-status.ts
video-upscale.ts            # è§†é¢‘æ”¾å¤§
video-interpolation.ts      # è§†é¢‘æ’å¸§
talking-head.ts             # æ•°å­—äºº
talking-head-status.ts
proxyVideo.ts               # è§†é¢‘ä»£ç†
```

#### å…¶ä»–å·¥å…·
```
frame-interpolation.ts      # å¸§æ’å€¼
inbetween.ts                # ä¸­é—´å¸§ç”Ÿæˆ
```

### 8. æ”¯ä»˜ç³»ç»Ÿ

#### ä¿¡ç”¨åŒ…ç±»å‹
```
XS:   800-1300 Zaps
S:    2000-5000 Zaps
SM:   3500-10000 Zaps
M:    9000-20000 Zaps
L:    20000-40000 Zaps
XL:   52500-99500 Zaps
XXL:  221500-399500 Zaps
```

#### è®¢é˜…è®¡åˆ’
- Premiumï¼ˆæœˆåº¦/å¹´åº¦ï¼‰
- Plusï¼ˆæœˆåº¦/å¹´åº¦ï¼‰
- Starterï¼ˆæœˆåº¦/å¹´åº¦ï¼‰

#### æ”¯ä»˜æµç¨‹
1. åˆ›å»ºStripe Checkout Session
2. ç”¨æˆ·å®Œæˆæ”¯ä»˜
3. Webhookæ¥æ”¶äº‹ä»¶ (`checkout.session.completed`, `invoice.payment_succeeded`)
4. æ›´æ–°æ•°æ®åº“è®¢é˜…/ä¿¡ç”¨
5. å‘é€é€šçŸ¥
6. è·Ÿè¸ªåˆ†æäº‹ä»¶

### 9. Cronä»»åŠ¡ (`vercel.json`)

```json
{
  "crons": [
    {
      "path": "/api/cron/classify-tags",
      "schedule": "0 3 * * *"
    },
    {
      "path": "/api/cron/sync-template-usage",
      "schedule": "0 3 * * *"
    }
  ]
}
```

### 10. å…³é”®ä¸šåŠ¡é€»è¾‘

#### å†…å®¹æµç³»ç»Ÿ (`fetchFeed.ts`)
- 4:1æ¯”ä¾‹æ··åˆå…è´¹/ä»˜è´¹å†…å®¹
- åœ°ç†ä½ç½®è¿‡æ»¤ï¼ˆä¸­å›½IPéšè—ä»˜è´¹å†…å®¹ï¼‰
- NSFWå†…å®¹è¿‡æ»¤
- æ”¯æŒåˆ†é¡µ
- å†…å­˜ç¼“å­˜ï¼ˆ30ç§’TTLï¼‰
- é€Ÿç‡é™åˆ¶ï¼ˆæ¯åˆ†é’Ÿ100è¯·æ±‚ï¼‰

#### æ¶ˆæ¯ç³»ç»Ÿ (`message.ts`)
- æ¶ˆæ¯ç±»å‹ï¼šç‚¹èµã€è¯„è®ºã€å…³æ³¨ã€è§’è‰²æ”¶è—ã€ä½¿ç”¨é€šçŸ¥ã€ç²¾é€‰ã€å¾½ç« 
- èšåˆæ¶ˆæ¯ï¼ˆåŒä¸€ç±»å‹å¤šæ¡æ¶ˆæ¯åˆå¹¶ï¼‰
- æœªè¯»è®¡æ•°
- æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–ï¼ˆç”¨æˆ·ã€å¸–å­ã€è§’è‰²ç¼“å­˜ï¼‰

#### è§’è‰²ç³»ç»Ÿ
- è‡ªå®šä¹‰è§’è‰²åˆ›å»º
- è§’è‰²æ”¶è—å’Œä½¿ç”¨
- è§’è‰²IDæ›¿æ¢ï¼ˆPromptä¸­ï¼‰
- è§’è‰²æè¿°å’Œæ›¿ä»£æç¤ºè¯

#### æ ‡ç­¾ç³»ç»Ÿ
- æ ‡ç­¾ç®¡ç†
- çƒ­é—¨æ ‡ç­¾æŸ¥è¯¢
- æ ‡ç­¾è¯·æ±‚
- åœ°ç†ä½ç½®ç›¸å…³æ ‡ç­¾æ¨è

#### ä¿¡ç”¨ç³»ç»Ÿ
- å…è´¹ä¿¡ç”¨
- è®¢é˜…ä¿¡ç”¨ï¼ˆæ¯æœˆç»­è´¹ï¼‰
- ä¸€æ¬¡æ€§ä¿¡ç”¨åŒ…
- æ¶ˆè´¹è®°å½•
- é€Ÿç‡é™åˆ¶æ£€æŸ¥

#### å®¡æ ¸ç³»ç»Ÿ
- NSFWæ ‡è®°
- ç”¨æˆ·ä¸¾æŠ¥
- å®¡æ ¸çŠ¶æ€è·Ÿè¸ª

---

## æ•°æ®åº“è®¾è®¡

### Supabase PostgreSQL

#### æ ¸å¿ƒè¡¨ç»“æ„

**Userè¡¨**
```sql
- id: UUID (ä¸»é”®)
- email: String
- username: String
- avatar_url: String
- language: String
- role: Integer (1=ADMIN)
- is_active: Boolean
- created_at: Timestamp
- updated_at: Timestamp
```

**Subscriptionsè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- plan: String (PREMIUM, PLUS, STARTER)
- status: String (active, canceled, past_due)
- stripe_customer_id: String
- stripe_subscription_id: String
- current_period_end: Timestamp
- cancel_at_period_end: Boolean
```

**Creditsè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- balance: Integer (Zaps)
- monthly_renewal: Integer
- last_renewal_month: Integer
- created_at: Timestamp
```

**CustomCharactersè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- name: String
- description: Text
- avatar_url: String
- normalized_category: String
- is_official: Boolean (é»˜è®¤false)
- is_nsfw: Boolean
- alt_prompt: Text
- created_at: Timestamp
```

**CollectedCharactersè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- character_id: UUID (å¤–é”®)
- collected_at: Timestamp
```

**AppPostsè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- title: String
- description: Text
- media_urls: JSONB
- tags: String[]
- is_nsfw: Boolean
- is_premium: Boolean
- likes_count: Integer
- comments_count: Integer
- created_at: Timestamp
```

**AppVotesè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- post_id: UUID (å¤–é”®)
- vote_type: String (like, dislike)
```

**AppCommentsè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- post_id: UUID (å¤–é”®)
- content: Text
- created_at: Timestamp
```

**Followsè¡¨**
```sql
- follower_id: UUID (å¤–é”®)
- following_id: UUID (å¤–é”®)
- created_at: Timestamp
```

**Messagesè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- type: String (like, comment, follow, etc.)
- data: JSONB
- read: Boolean
- created_at: Timestamp
```

**Badgesè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- badge_type: String
- awarded_at: Timestamp
```

**DailyCheckInsè¡¨**
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”®)
- check_in_date: Date
- streak: Integer
```

**PromotionCodesè¡¨**
```sql
- id: UUID (ä¸»é”®)
- code: String
- reward_credits: Integer
- max_uses: Integer
- used_count: Integer
- expires_at: Timestamp
```

### æ•°æ®åº“ç‰¹æ€§

**Row-Level Security (RLS)**
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®

**è½¯åˆ é™¤**
- ä½¿ç”¨`is_active`æ ‡å¿—ä»£æ›¿ç‰©ç†åˆ é™¤
- ä¿ç•™å†å²è®°å½•

**PostgreSQLå‡½æ•°**
- å¤æ‚æŸ¥è¯¢é€šè¿‡RPCè°ƒç”¨
- ä¼˜åŒ–æ€§èƒ½

**Supabase Realtime**
- åŸºäºWebSocketçš„å®æ—¶æ›´æ–°
- å®æ—¶æ¶ˆæ¯æ¨é€
- å®æ—¶åœ¨çº¿çŠ¶æ€

### å­˜å‚¨æ¡¶

**husbando-land**
- ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡
- ç”Ÿæˆçš„å›¾åƒ
- è§†é¢‘æ–‡ä»¶
- ç¼©ç•¥å›¾

---

## ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ

### AI/ML æœåŠ¡æä¾›å•†

#### FAL.ai
- **SDK**: `@fal-ai/client`, `@fal-ai/server-proxy`, `@fal-ai/serverless-client`
- **å¹³å°ç±»å‹**: `'fal'`
- **æ¨¡å‹**:
  - Minimax Hailuo
  - Luma Ray 2
  - Wan 2.6, Wan Pro, Wan 2.2 Turbo
  - Kling v1.6, Kling 2.1
  - Pixverse v3.5
  - Vidu Q2 (Turbo, Pro, Reference)
  - Seedream v4.5, v4
  - Sora 2 (Standard, Pro)

#### Replicate
- **SDK**: `replicate`
- **å¹³å°ç±»å‹**: `'replicate'`
- **æ¨¡å‹**:
  - Kling v1.6
  - Animagine XL
  - NoobaiXL
  - Illustrious
  - Frame Pack
  - ToonCrafter

#### Google Gemini
- **SDK**: `@google/generative-ai`, `@google/genai`, `@anthropic-ai/vertex-sdk`
- **å¹³å°ç±»å‹**: `'gemini'`
- **æ¨¡å‹**:
  - gemini-2.5-flash-image
  - gemini-3-pro-image-preview
  - ç”¨äºå›¾åƒç”Ÿæˆã€ç¼–è¾‘ã€æ–‡æœ¬å¢å¼º

#### Luma AI
- **SDK**: `@lumaai/sdk`
- **ç”¨é€”**: è§†é¢‘ç”Ÿæˆ (Ray 2, Ray Flash 2)

#### RunwayML
- **SDK**: `@runwayml/sdk`
- **ç”¨é€”**: è§†é¢‘ç”Ÿæˆ (Act Two, Gen-4 Aleph)

#### OpenAI
- **SDK**: `openai`
- **ç”¨é€”**: GPTæ–‡æœ¬ç”Ÿæˆã€å›¾åƒç¼–è¾‘

#### å…¶ä»–AIå¹³å°
- **'deer'** - Midjourney Video (via MJ Fast Video)
- **'kie'** - KIE.AI (Sora 2, Grok Imagine)
- **'wavespeed'** - Wavespeed AI (Sora Stable)
- **'ark'** - ç«å±±æ–¹èˆŸï¼ˆå·²å¼ƒç”¨ï¼‰

### æ•°æ®åº“ä¸å­˜å‚¨

#### Supabase
- **SDK**: `@supabase/supabase-js`
- **å­˜å‚¨æ¡¶**: `husbando-land`
- **åŠŸèƒ½**:
  - PostgreSQLæ•°æ®åº“
  - æ–‡ä»¶å­˜å‚¨
  - å®æ—¶è®¢é˜… (WebSocket)
  - è®¤è¯ç³»ç»Ÿ
  - Row-Level Security

### æ”¯ä»˜å¤„ç†

#### Stripe
- **SDK**: `stripe`
- **åŠŸèƒ½**:
  - è®¢é˜…ç®¡ç†
  - ä¸€æ¬¡æ€§ä»˜æ¬¾
  - Webhookå¤„ç†
  - ä¿¡ç”¨åŒ…è´­ä¹°

### åˆ†æ

#### PostHog
- **SDK**: `posthog-js`, `posthog-node`
- **ç”¨é€”**: äº‹ä»¶è·Ÿè¸ªã€ç”¨æˆ·è¡Œä¸ºåˆ†æ

#### Mixpanel
- **SDK**: `mixpanel-browser`
- **ç”¨é€”**: ç”¨æˆ·è¡Œä¸ºåˆ†æ

#### Vercel Analytics
- **SDK**: `@vercel/analytics`
- **ç”¨é€”**: æ€§èƒ½åˆ†æ

### é‚®ä»¶æœåŠ¡

#### Resend
- **SDK**: `resend`
- **ç”¨é€”**: äº‹åŠ¡æ€§é‚®ä»¶å‘é€

### å…¶ä»–é›†æˆ

#### Lark (é£ä¹¦)
- **ç”¨é€”**: Webhooké€šçŸ¥
- **å†…éƒ¨åä½œé€šçŸ¥

#### ProductHunt
- **ç”¨é€”**: APIä»£ç†ã€å¾½ç« æ˜¾ç¤º

#### GeoIP
- **SDK**: `geoip-lite`
- **ç”¨é€”**: IPåœ°ç†ä½ç½®æ£€æµ‹

#### Ghost CMS
- **SDK**: `@tryghost/content-api`
- **ç”¨é€”**: åšå®¢å†…å®¹ç®¡ç†

### è®¤è¯æœåŠ¡

#### NextAuth.js
- **ç‰ˆæœ¬**: 4.24.7 (å·²ä¿®æ”¹)
- **æä¾›è€…**:
  - GitHub OAuth
  - Google OAuth
  - Emailè®¤è¯
- **ä¿®æ”¹**: `scripts/replaceNextAuthCode.cjs`

---

## éƒ¨ç½²é…ç½®

### 1. Next.jsé…ç½® (`next.config.mjs`)

#### å®éªŒæ€§åŠŸèƒ½
```javascript
experimental: {
  serverComponentsExternalPackages: [
    'canvas', 'sharp', 'konva', 'react-konva', 'three'
  ],
  optimizePackageImports: ['lucide-react', 'date-fns'],
  outputFileTracingIncludes: {
    '/api/**/*': ['./node_modules/@supabase/**/*']
  },
  outputFileTracingExcludes: {
    '/ai-anime-generator/[variant]': [...],
    '/generate': [...],
    '/oc-maker/[variant]': [...],
    '/world/play': [...]
  }
}
```

#### å›¾ç‰‡ä¼˜åŒ–
```javascript
images: {
  remotePatterns: [
    { protocol: 'https', hostname: 'dihulvhqvmoxyhkxovko.supabase.co' },
    { protocol: 'https', hostname: '*.ghost.io' },
    { protocol: 'https', hostname: 'komiko.app' },
    // ...æ›´å¤šåŸŸå
  ]
}
```

#### é‡å®šå‘è§„åˆ™
- åŸŸåé‡å®šå‘ï¼š`app.komiko.app` â†’ `komiko.app`
- è·¯å¾„é‡å®šå‘ï¼šæ—§è·¯ç”± â†’ æ–°è·¯ç”±
- HTTPSé‡å®šå‘

#### Headersé…ç½®
```javascript
headers: [
  {
    source: '/:path*',
    headers: [
      { key: 'Access-Control-Allow-Credentials', value: 'true' },
      { key: 'Access-Control-Allow-Origin', value: '*' },
      { key: 'Access-Control-Allow-Methods', value: 'GET,OPTIONS,PATCH,DELETE,POST,PUT' }
    ]
  },
  {
    source: '/:all*(jpg|jpeg|png|gif|webp|svg|ico)',
    headers: [{ key: 'Cache-Control', value: 'public, max-age=31536000, immutable' }]
  },
  {
    source: '/(.*)',
    headers: [
      { key: 'X-Content-Type-Options', value: 'nosniff' },
      { key: 'X-Frame-Options', value: 'DENY' },
      { key: 'Referrer-Policy', value: 'origin-when-cross-origin' }
    ]
  }
]
```

#### Rewrites
```javascript
rewrites: [
  { source: '/v2/api/:path*', destination: '/api/:path*' },
  { source: '/robots.txt', destination: '/api/robots.txt' },
  { source: '/sitemap.xml', destination: '/api/sitemap.xml' },
  {
    source: '/ingest/static/:path*',
    destination: 'https://us-assets.i.posthog.com/static/:path*'
  },
  {
    source: '/ingest/:path*',
    destination: 'https://us.i.posthog.com/:path*'
  }
]
```

#### å›½é™…åŒ–é…ç½®
```javascript
i18n: {
  defaultLocale: 'en',
  locales: LANGUAGES, // 15ç§è¯­è¨€
  localeDetection: false,
  domains: [
    {
      domain: 'komiko.app',
      defaultLocale: 'en'
    }
  ]
}
```

#### Webpacké…ç½®
```javascript
webpack: (config, { isServer }) => {
  // æœåŠ¡ç«¯ï¼šå¤–éƒ¨åŒ–å¤§å‹ä¾èµ–
  if (isServer) {
    config.externals = [
      'canvas', 'sharp', 'konva', 'react-konva', 'three'
    ]
  }

  // å®¢æˆ·ç«¯ï¼šä»£ç åˆ†å‰²
  if (!isServer) {
    config.optimization.splitChunks.cacheGroups = {
      heavyLibs: {
        test: /[\\/]node_modules[\\/](canvas|konva|react-konva|three)[\\/]/,
        name: 'heavy-libs',
        chunks: 'all',
        priority: 100,
        enforce: true
      },
      'pose-editor': { ... },
      'inf-canva': { ... }
    }
  }

  return config
}
```

### 2. Vercelé…ç½® (`vercel.json`)

```json
{
  "crons": [
    {
      "path": "/api/cron/classify-tags",
      "schedule": "0 3 * * *"
    },
    {
      "path": "/api/cron/sync-template-usage",
      "schedule": "0 3 * * *"
    }
  ]
}
```

### 3. TypeScripté…ç½® (`tsconfig.json`)

```json
{
  "compilerOptions": {
    "target": "ESNext",
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "module": "ESNext",
    "moduleResolution": "Node",
    "jsx": "preserve",
    "strict": true,
    "baseUrl": "src/",
    "paths": {
      "@/components/*": ["Components/*"],
      "@/Components/*": ["Components/*"],
      "@/ui/*": ["Components/common/*"],
      "@/utils/*": ["utilities/*"],
      "@/api/*": ["api/*"],
      "@/lib/*": ["lib/*"],
      "@/styles/*": ["styles/*"],
      "@/state": ["state/index"],
      "@/state/*": ["state/*"],
      "@/hooks/*": ["hooks/*"],
      "contentlayer/generated": [".contentlayer/generated"]
    }
  }
}
```

### 4. ç¯å¢ƒå˜é‡

#### æœåŠ¡ç«¯å˜é‡
```bash
NEXTAUTH_URL
NEXTAUTH_SECRET
GITHUB_CLIENT_ID
GITHUB_CLIENT_SECRET
STRIPE_API_KEY
STRIPE_WEBHOOK_SECRET
RESEND_API_KEY
RESEND_FROM
ADMIN_EMAIL
IS_DEBUG
```

#### å®¢æˆ·ç«¯å˜é‡
```bash
NEXT_PUBLIC_APP_URL
NEXT_PUBLIC_GOOGLE_CLIENT_ID
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY
```

#### AI APIå¯†é’¥
```bash
FAL_KEY
REPLICATE_API_TOKEN
GOOGLE_AI_KEY
GOOGLE_CLOUD_PROJECT_ID
LUMAAI_API_KEY
RUNWAYML_API_KEY
OPENAI_API_KEY
ANTHROPIC_API_KEY
```

### 5. éƒ¨ç½²å¹³å°

#### Vercel
- **å¹³å°**: Vercel Serverless Functions
- **è¶…æ—¶**: 4.5åˆ†é’Ÿ
- **åŒºåŸŸ**: è‡ªåŠ¨ä¼˜åŒ–
- **åŠŸèƒ½**:
  - APIè·¯ç”±éƒ¨ç½²
  - é™æ€æ–‡ä»¶æ‰˜ç®¡
  - è¾¹ç¼˜ç½‘ç»œ
  - Cronä»»åŠ¡
  - ç¯å¢ƒå˜é‡ç®¡ç†

#### Supabase
- **æ•°æ®åº“**: PostgreSQL
- **å­˜å‚¨**: å¯¹è±¡å­˜å‚¨
- **å®æ—¶**: WebSocket
- **è®¤è¯**: OAuthæä¾›å•†

---

## å¼€å‘è§„èŒƒ

### 1. ä»£ç ä¿®æ”¹åŸåˆ™ (`å¼€å‘åŸåˆ™.md`)

1. **ä¸è¦ä¿®æ”¹æ­£å¸¸è¿è¡Œçš„ä»£ç **ï¼Œå°¤å…¶æ˜¯åç«¯ä»£ç 
   - å¦‚éœ€ä¿®æ”¹ï¼Œå’¨è¯¢åŸä½œè€…
   - ä½¿ç”¨GitLensæŸ¥çœ‹ä»£ç å†å²

2. **æ–°å¢ä¼˜äºä¿®æ”¹**
   - æœ€å¥½æ·»åŠ æ–°ä»£ç è€Œä¸æ˜¯ä¿®æ”¹æ—§ä»£ç 

3. **é‡æ„å‰å¿…é¡»æµ‹è¯•**
   - ç¡®ä¿æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰æƒ…å†µ

4. **ä»£ç ç®€æ´ä¼˜å…ˆ**
   - ä½¿ç”¨æœ€ç®€å•çš„ä»£ç å®ç°åŠŸèƒ½
   - æ–°æ¯•ä¸šç”Ÿä¹Ÿèƒ½çœ‹æ‡‚çš„ä»£ç 
   - å‡å°‘å¿ƒæ™ºè´Ÿæ‹…ï¼Œé˜²æ­¢AIè¿‡åº¦å¤æ‚åŒ–

5. **å……åˆ†æµ‹è¯•**
   - AIä¸æ˜¯é“¶å¼¹ï¼Œä¸è¦å®Œå…¨ä¿¡ä»»
   - å¤šæ¬¡éªŒè¯ç»“æœ

### 2. Canvaså¼€å‘æŒ‡å—

1. **InfCanva.tsxåŒ…å«ä¸»è¦é€»è¾‘**ï¼Œéœ€è¦é‡æ„ï¼š
   - æå–å˜é‡åˆ°`/src/store`ä¸­çš„atoms
   - æå–å¯å¤ç”¨é€»è¾‘åˆ°`/src/hooks`

2. **é¿å…react-konva**
   - é™¤éæ·±å…¥äº†è§£Konva.jså†…éƒ¨
   - ä½¿ç”¨åŸç”ŸKonva + refs

3. **èŠ‚ç‚¹å˜æ¢æ³¨æ„äº‹é¡¹**ï¼š
   - ComicBubbleå’ŒComicPageï¼štransformerä½œç”¨äºå¤–å±‚Konva.Group
   - ComicImageï¼štransformerç›´æ¥ä½œç”¨äºKonva.Image
   - å§‹ç»ˆæ£€æŸ¥å“ªä¸ªå…ƒç´ æ¥æ”¶å˜æ¢äº‹ä»¶

4. **å›¾åƒå°ºå¯¸è®¡ç®—**ï¼š
   - è€ƒè™‘`STAGE_SCALE_VALUE`å¸¸é‡
   - è€ƒè™‘Layer scale
   - è€ƒè™‘Konva.Image scaleå±æ€§
   - è€ƒè™‘çˆ¶Konva.Group scale
   - ä¸æ¸…æ¥šæ—¶ä½¿ç”¨`getClientRect()`

5. **RightSidebarå’ŒOptionsç»„ä»¶**ï¼š
   - å­˜åœ¨è¿‡åº¦prop drilling
   - ä½¿ç”¨hookså’ŒçŠ¶æ€ç®¡ç†é‡æ„

### 3. æäº¤è§„èŒƒ

**Git Commit Angularè§„èŒƒ**
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
refactor: é‡æ„
perf: æ€§èƒ½ä¼˜åŒ–
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·å˜åŠ¨
```

### 4. ä»£ç é£æ ¼

- ä½¿ç”¨TypeScript
- ä½¿ç”¨ESLintå’ŒPrettier
- æ¯æ¬¡æ”¹åŠ¨åè¿è¡Œ`npx eslint {filename} --fix`
- è€ƒè™‘`.eslintrc.cjs`å’Œ`.prettierrc.cjs`é…ç½®

### 5. å¼€å‘ç¯å¢ƒè¦æ±‚

- **Node.js**: v20.xxï¼ˆæ–°ç‰ˆæœ¬å¯èƒ½ä¸å…¼å®¹ï¼‰
- **å¹³å°**: macOSæˆ–Linux/WSLï¼ˆWindowsæœ‰ç›®å½•ç»“æ„é—®é¢˜ï¼‰
- **åç«¯**: æ‰€æœ‰APIè·¯ç”±åœ¨Vercelè¿è¡Œï¼ˆæœ¬åœ°å¼€å‘ä½¿ç”¨Vercel CLIï¼‰
- **å¿…éœ€**: `.env`æ–‡ä»¶ï¼ˆå‘å›¢é˜Ÿç”³è¯·ï¼‰

---

## æ„å»ºä¸éƒ¨ç½²æµç¨‹

### 1. å¼€å‘è„šæœ¬ (`package.json`)

#### åŸºç¡€å‘½ä»¤
```bash
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆéœ€è¦Vercel CLIï¼‰
npm run build            # ç”Ÿäº§æ„å»º
npm run start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run lint             # ESLintæ£€æŸ¥
```

#### æ„å»ºè„šæœ¬
```bash
npm run build:tools      # æå–å·¥å…·å…ƒæ•°æ®
npm run sitemap          # ç”ŸæˆXML sitemap
```

**é¢„æ„å»ºæµç¨‹**ï¼š
```bash
prebuild â†’ build:tools â†’ sitemap â†’ next build
```

### 2. å›½é™…åŒ–è„šæœ¬

#### åˆå§‹åŒ–ç¿»è¯‘
```bash
npm run i18n:init
node --env-file=.env scripts/i18n/translateI18n.cjs
```

#### æ›´æ–°ç¿»è¯‘
```bash
npm run i18n:update
node --env-file=.env scripts/i18n/updateI18n.cjs
```

#### åŒæ­¥ç¿»è¯‘
```bash
npm run i18n:sync
node --env-file=.env scripts/i18n/syncI18n.cjs
```

#### ç¿»è¯‘å˜ä½“é¡µé¢
```bash
npm run i18n:translate-variants
node --env-file=.env scripts/i18n/translateVariants.cjs
```

**æ³¨æ„äº‹é¡¹**ï¼š
- Nodeç‰ˆæœ¬éœ€è¦v22.xx
- ä¸­å›½å¤§é™†å¯èƒ½æ— æ³•è¿è¡Œ
- éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ

### 3. å˜ä½“é¡µé¢ç”Ÿæˆ (SEO)

#### å¿«é€Ÿå¼€å§‹
```bash
npm run gen:setup          # åˆå§‹åŒ–é…ç½®
npm run gen:list           # åˆ—å‡ºå¯ç”¨å·¥å…·
npm run gen ai-anime-generator naruto  # ç”Ÿæˆå˜ä½“é¡µé¢
```

#### è‡ªå®šä¹‰é€‰é¡¹
```bash
npm run gen ai-anime-generator "demon slayer" -- --model=GPT --count=8
```

#### å¯ç”¨å‘½ä»¤
| å‘½ä»¤ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `npm run gen:setup` | åˆå§‹åŒ–é…ç½® | `npm run gen:setup` |
| `npm run gen:list` | æ˜¾ç¤ºå¯ç”¨å·¥å…· | `npm run gen:list` |
| `npm run gen <tool> <keyword>` | ç”Ÿæˆå˜ä½“é¡µé¢ | `npm run gen ai-anime-generator naruto` |

#### æ ‡è®°ç³»ç»Ÿ
- åœ¨æ–°å·¥å…·é¡µé¢æ·»åŠ æ³¨é‡Šï¼š`// [#target:tools]`
- è„šæœ¬ä¼šè‡ªåŠ¨æå–å¹¶ç”Ÿæˆtoolsé¡µé¢
- ç¿»è¯‘æ–‡ä»¶åéœ€è¦ä¸å·¥å…·é¡µé¢åç§°ä¸€è‡´

### 4. Vercel CLIéƒ¨ç½²

#### å®‰è£…
```bash
npm install -g vercel
```

#### ç™»å½•
```bash
vercel login
```

#### å¼€å‘
```bash
vercel dev
```

#### éƒ¨ç½²
```bash
vercel
vercel --prod  # ç”Ÿäº§ç¯å¢ƒ
```

### 5. æ„å»ºä¼˜åŒ–

#### ä»£ç åˆ†å‰²
```javascript
// å¤§å‹åº“å•ç‹¬æ‰“åŒ…
heavyLibs: canvas, konva, react-konva, three
pose-editor: PoseEditorç»„ä»¶
inf-canva: InfCanvaç»„ä»¶
```

#### åŒ…ä¼˜åŒ–
```javascript
optimizePackageImports: ['lucide-react', 'date-fns']
```

#### æœåŠ¡ç«¯ç»„ä»¶å¤–éƒ¨åŒ–
```javascript
serverComponentsExternalPackages: [
  'canvas', 'sharp', 'konva', 'react-konva', 'three'
]
```

### 6. ç›‘æ§ä¸è°ƒè¯•

#### åˆ†æå·¥å…·
- **PostHog**: äº‹ä»¶è·Ÿè¸ª
- **Mixpanel**: ç”¨æˆ·è¡Œä¸º
- **Vercel Analytics**: æ€§èƒ½æŒ‡æ ‡
- **Bundle Analyzer**: åŒ…å¤§å°åˆ†æ
  ```bash
  ANALYZE=true npm run build
  ```

#### é”™è¯¯å¤„ç†
- ç”Ÿäº§ç¯å¢ƒé”™è¯¯è¿½è¸ª
- æ—¥å¿—èšåˆ
- æ€§èƒ½ç›‘æ§

---

## é™„å½•

### A. å…³é”®æ–‡ä»¶é€ŸæŸ¥

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” |
|----------|------|
| `/src/state/index.ts` | æ‰€æœ‰Jotai atoms |
| `/src/Components/InfCanva/InfCanva.tsx` | ç”»å¸ƒç¼–è¾‘å™¨æ ¸å¿ƒ |
| `/api/_utils/index.ts` | APIå·¥å…·å‡½æ•° |
| `/src/pages/ai-comic-generator.tsx` | å¤æ‚å·¥å…·é¡µé¢ç¤ºä¾‹ |
| `/api/generation/_common/models.ts` | 60+æ¨¡å‹é…ç½® |
| `/src/constants/index.tsx` | å·¥å…·ã€æšä¸¾ã€é…ç½® |
| `/src/hooks/` | è‡ªå®šä¹‰Hooks |
| `/api/_utils/middlewares/` | APIä¸­é—´ä»¶ |
| `/src/utilities/` | å·¥å…·å‡½æ•° |
| `/next.config.mjs` | æ„å»ºå’Œéƒ¨ç½²é…ç½® |
| `/tailwind.config.mjs` | æ ·å¼é…ç½® |

### B. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# å¼€å‘
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run build            # ç”Ÿäº§æ„å»º
npm run lint             # ä»£ç æ£€æŸ¥

# å›½é™…åŒ–
npm run i18n:init        # åˆå§‹åŒ–ç¿»è¯‘
npm run i18n:update      # æ›´æ–°ç¿»è¯‘
npm run i18n:sync        # åŒæ­¥ç¿»è¯‘

# SEOå˜ä½“
npm run gen:setup        # è®¾ç½®å˜ä½“ç”Ÿæˆ
npm run gen:list         # åˆ—å‡ºå¯ç”¨å·¥å…·
npm run gen <tool> <keyword>  # ç”Ÿæˆå˜ä½“

# éƒ¨ç½²
vercel dev              # Vercelå¼€å‘
vercel                  # é¢„è§ˆéƒ¨ç½²
vercel --prod           # ç”Ÿäº§éƒ¨ç½²
```

### C. ä¿¡ç”¨ç³»ç»Ÿ

#### ä¿¡ç”¨å•ä½
- 1 Zaps = åŸºæœ¬å•ä½
- 1 USD = 2000 Zaps

#### ä¿¡ç”¨æ¥æº
- å…è´¹ä¿¡ç”¨
- è®¢é˜…ä¿¡ç”¨ï¼ˆæ¯æœˆç»­è´¹ï¼‰
- ä¸€æ¬¡æ€§ä¿¡ç”¨åŒ…
- æ¯æ—¥ç­¾åˆ°å¥–åŠ±

#### ä¿¡ç”¨æ¶ˆè€—
- å›¾åƒç”Ÿæˆï¼š20-50 Zaps
- è§†é¢‘ç”Ÿæˆï¼šæ ¹æ®æ—¶é•¿å’Œåˆ†è¾¨ç‡
- è§†é¢‘æ”¾å¤§ï¼š480 Zaps
- å…¶ä»–åŠŸèƒ½ï¼šæŒ‰æ¨¡å‹å’ŒåŠŸèƒ½å®šä»·

### D. é”™è¯¯ç  (`api/_constants.ts`)

```typescript
POST_DELETE_ERROR = 1001
GENERATION_FAILED = 1004
RATE_LIMIT_EXCEEDED = 1010
NOT_ENOUGH_ZAPS = 1011
UNAUTHORIZED = 1013
USER_NOT_FOUND = 1014
```

### E. KUSAé£æ ¼åˆ—è¡¨ (90+ç§)

åˆ†ç±»ï¼š
- Art
- Anime
- Chibi
- Manga
- Furry
- 3D
- å…¶ä»–é£æ ¼

æ¯ç§é£æ ¼æœ‰å¯¹åº”çš„æç¤ºè¯å’Œé…ç½®ã€‚

---

## æ€»ç»“

Komikoæ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„AIé©±åŠ¨å†…å®¹åˆ›ä½œå¹³å°ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### æŠ€æœ¯äº®ç‚¹
1. **å…¨æ ˆæ¶æ„**ï¼šNext.js 14 + Supabase
2. **Canvasç¼–è¾‘**ï¼šåŸºäºKonva.jsçš„å¤æ‚ç”»å¸ƒç³»ç»Ÿ
3. **AIé›†æˆ**ï¼šå¤šä¸ªAIå¹³å°ï¼ˆFALã€Replicateã€Geminiç­‰ï¼‰
4. **å®æ—¶åä½œ**ï¼šSupabase Realtime
5. **å›½é™…åŒ–**ï¼š15ç§è¯­è¨€æ”¯æŒ
6. **æ”¯ä»˜ç³»ç»Ÿ**ï¼šStripeé›†æˆï¼Œè®¢é˜…+ä¿¡ç”¨åŒ…
7. **SEOä¼˜åŒ–**ï¼šåŠ¨æ€å˜ä½“é¡µé¢ç”Ÿæˆ

### æ¶æ„ä¼˜åŠ¿
1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„ç›®å½•ç»“æ„
2. **çŠ¶æ€ç®¡ç†**ï¼šJotaiåŸå­åŒ–çŠ¶æ€
3. **ä»£ç åˆ†å‰²**ï¼šä¼˜åŒ–åŠ è½½æ€§èƒ½
4. **ä¸­é—´ä»¶é“¾**ï¼šçµæ´»çš„APIå¤„ç†
5. **ç±»å‹å®‰å…¨**ï¼šå…¨é¢TypeScriptæ”¯æŒ

### å¼€å‘è§„èŒƒ
1. ç®€æ´ä¼˜å…ˆ
2. æ–°å¢ä¼˜äºä¿®æ”¹
3. å……åˆ†æµ‹è¯•
4. æ–‡æ¡£é½å…¨

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-02-22
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
